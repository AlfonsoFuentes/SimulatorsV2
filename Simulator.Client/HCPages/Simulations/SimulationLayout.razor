@using GeminiSimulator.DesignPatterns
@using GeminiSimulator.Main
@using GeminiSimulator.PlantUnits
@using GeminiSimulator.PlantUnits.Lines

@using GeminiSimulator.PlantUnits.ManufacturingEquipments.Mixers
@using GeminiSimulator.PlantUnits.ManufacturingEquipments.Skids
@using GeminiSimulator.PlantUnits.Tanks
<MudGrid Spacing="2" Class="pa-4" Style="background-color: #f8fafd; min-height: 100vh;">

    <MudItem sm="3" xs="12">
        <MudText Typo="Typo.overline" Color="Color.Primary" Class="mb-2 d-block">Raw Materials</MudText>
        <MudStack Spacing="2">
            @foreach (var unit in Engine.RawMaterialTanks)
            {
                <UnitCard Snapshot="GetSnapshot(unit.Id)" />
            }
        </MudStack>
    </MudItem>

    <MudItem sm="3" xs="12">
        <MudText Typo="Typo.overline" Color="Color.Secondary" Class="mb-2 d-block">Manufacturing Systems</MudText>
        <MudStack Spacing="2">
            @foreach (var unit in Engine.Manufacture)
            {
                <UnitCard Snapshot="GetSnapshot(unit.Id)" />
            }
        </MudStack>
    </MudItem>

    <MudItem sm="6" xs="12">
        <div class="d-flex justify-space-between px-4">
            <MudText Typo="Typo.overline">WIP Tanks</MudText>
            <MudText Typo="Typo.overline">Packaging Lines</MudText>
        </div>

        <MudDivider Class="mb-3" />

        <MudStack Spacing="2">
            @foreach (var pair in Engine.WipLinePairList)
            {
                <div class="d-flex align-center gap-2">
                    <div style="flex: 1;">
                        <UnitCard Snapshot="GetSnapshot(pair.WipId)" />
                    </div>

                    <MudIcon Icon="@Icons.Material.Filled.ArrowForward"
                             Size="Size.Small"
                             Style="color: #bdbdbd;" />

                    <div style="flex: 1;">
                        <UnitCard Snapshot="GetSnapshot(pair.LineId)" />
                    </div>
                </div>
            }
        </MudStack>
    </MudItem>
</MudGrid>

@code {
    // Almacenamos el último snapshot recibido del Engine
    [Parameter] public SimulationEngine Engine { get; set; } = null!;
    [Parameter] public SimulationSnapshot? CurrentSnapshot { get; set; }
    private Dictionary<string, ReportField>? GetSnapshot(Guid unitId)
    {
        return CurrentSnapshot?.EquipmentData.GetValueOrDefault(unitId);
    }

    // Ahora los métodos que definimos antes usan el parámetro 'Engine'
   
}